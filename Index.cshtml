@using Accounts.Data.AccountsDataModel
@using ERP.Web.Helpers
@using System.Data;
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_LayoutUcasportfolio.cshtml";

    var DepartmentList = ((DataTable)ViewBag.DepartmentList).AsEnumerable().Select(x => new
    {
        Id = x.Field<int>("Id"),
        DeptShortName = x.Field<string>("DeptShortName")
    }).ToList();
}

@*<h2>Index</h2>*@
<style type="text/css">
    .srchtable {
        font-family: Arial, Helvetica, sans-serif;
        border-collapse: collapse;
        width: 100%;
    }

        .srchtable td, .srchtable th {
            border: 1px solid #ddd;
            padding: 8px;
        }

        .srchtable tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        .srchtable tr:hover {
            background-color: #ddd;
        }

        .srchtable th {
            padding-top: 12px;
            padding-bottom: 12px;
            text-align: left;
            background-color: #04AA6D;
            color: white;
        }

    .srchtable2 {
        font-family: Arial, Helvetica, sans-serif;
        border-collapse: collapse;
        width: 100%;
    }

        .srchtable2 td, .srchtable2 th {
            border: 1px solid #ddd;
            padding: 8px;
        }

        .srchtable2 tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        .srchtable2 tr:hover {
            background-color: #ddd;
        }

        .srchtable2 th {
            padding-top: 12px;
            padding-bottom: 12px;
            text-align: left;
            background-color: #04AA6D;
            color: white;
        }

    .bordercss {
        border: 3px double #CCCCCC;
        color: black;
    }

        .bordercss:focus {
            box-shadow: 0 0 5px rgba(81, 203, 238, 1);
            border: 2px solid rgba(81, 203, 238, 1);
        }

    /*for kendo grid*/
    .k-grouping-header {
        background-color: #1ABB9C;
    }

    x_panel {
        position: relative;
        width: 100%;
        margin-bottom: 10px;
        padding: 0px 0px;
        display: inline-block;
        background: #fff;
        border: 1px solid #E6E9ED;
        -webkit-column-break-inside: avoid;
        opacity: 1;
        transition: all .2s ease;
    }

    hr {
        margin-top: 5px;
        margin-bottom: 5px;
        border: 0;
        border-top: 3px solid #6aa79b;
    }

    .btn-action {
        display: inline-block;
        padding: 0px 4px;
        margin-left: 2px;
        font-size: 16px;
        font-weight: 400;
        line-height: 1.42857143;
        text-align: center;
        white-space: nowrap;
        vertical-align: middle;
        -ms-touch-action: manipulation;
        touch-action: manipulation;
        cursor: pointer;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        background-image: none;
        border: 1px solid transparent;
        border-radius: 4px;
    }
    div.panel-heading h3{
        text-align:center;
    }
</style>

<div class="row" style="display:none">
    <div class="col-sm-12">
        <div class="panel panel-success panel-custom">
            <div class="panel-heading PageHeader">
                <h3 class="panel-title" >STUDENT INFOPRMATION</h3>
            </div>
            <div class="panel-body">
                <div class="row">
                    <div class="row form-group">
                        <div class="col-sm-1 label-container">
                        </div>

                        <div class="col-sm-2 label-container">
                            @Html.Label("Student Name", new { @class = "control-label" })
                        </div>
                        <div class="col-sm-3">
                            <input type="text" class="form-control input-sm" data-id="0" data-vale="" id="txtSubledgerName" />
                        </div>
                        <div class="col-sm-3 label-container">
                            @Html.Label("Student Contract No:", new { @class = "control-label" })
                        </div>
                        <div class="col-sm-3">
                            <input type="text" class="form-control input-sm" data-id="0" data-vale="" id="txtShortName" />
                        </div>
                        <br />

                    </div>
                    <div class="row form-group">
                        <div class="col-sm-2"></div>
                        <div class="col-sm-1 label-container">
                            @Html.Label("Department", new { @class = "control-label" })
                        </div>
                        <div class="col-sm-3">
                            <select class="form-control input-sm bordercss" id="ddlSubledgerDropdown">
                                <option value="0">Please Select</option>
                                @*@foreach (var dt in SubLedgerList)
                                    {
                                        <option value="@dt.Id">@dt.SubledgerName</option>
                                    }*@
                            </select>
                        </div>
                        <div class="col-sm-2 label-container">
                            @Html.Label("Subject", new { @class = "control-label" })
                        </div>
                        <div class="col-sm-3">
                            <select class="form-control input-sm bordercss" id="ddlSubMasterDropdown" autofocus="autofocus">
                                <option value="0">Please Select</option>
                                @*@foreach (var dt in SubMasterList)
                                    {
                                        <option value="@dt.Id">@dt.SubledgerMasterName</option>
                                    }*@
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-1 col-sm-offset-6">
                <input type="button" name="btnSubmit" id="btnSave" class="btn btn-sm btn-success" value="Save" />
            </div>
        </div>
        <br />

    </div>
</div>

<div class="row">
    <div class="col-sm-12">
        <div class="panel panel-success panel-custom">
            <div class="panel-heading PageHeader">
                <h3 class="panel-title">Student Information</h3>
            </div>
            <div class="panel-body">
                <div class="row">
                    <div class="row form-group">
                        @Html.Label("Student Name", htmlAttributes: new { @class = "control-label col-md-2 required" })
                        <div class="col-md-4 col-sm-6 col-xs-12">
                            @Html.Editor("STudentName", new { htmlAttributes = new { @class = "form-control" } })
                        </div>
                        @Html.Label("Mobile No", htmlAttributes: new { @class = "control-label col-md-2 required" })
                        <div class="col-md-3 col-sm-6 col-xs-12">
                            @Html.Editor("StudentContactNo", new { htmlAttributes = new { @class = "form-control", @Placeholder = "01xxxxxxxxx", @autofocus = true } })
                        </div>
                    </div>
                    <div class="row form-group">
                        @Html.Label("Department", htmlAttributes: new { @class = "control-label col-md-2" })
                        @*@Html.Label("Department", new { @class = "control-label" })*@
                        <div class="col-md-4 col-sm-6 col-xs-12">
                            <select class="form-control input-sm bordercss" id="stdDeptId">
                                <option value="0">Please Select</option>
                                @foreach (var dt in DepartmentList)
                                {
                                    <option value="@dt.Id">@dt.DeptShortName</option>
                                }
                            </select>

                        </div>
                        @Html.Label("Subject", new { @class = "control-label col-md-2" })

                        <div class="col-sm-3">
                            <select class="form-control input-sm bordercss" id="stdSubInfoId" autofocus="autofocus">
                                <option value="0">Please Select</option>

                            </select>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-1 col-sm-offset-6">
            <input type="button" name="btnSubmit" id="btnSave" class="btn btn-sm btn-success" value="Save" />
        </div>
    </div>
    <br />
    
</div>
<div class="x_panel">
    <div class="x_content">
        <h3 style="text-align:center">Student Details</h3>
        <fieldset>
            <div class="row form-group">
                <br />
                <div id="grid"></div>
            </div>
        </fieldset>
    </div>
</div>

<script type="text/javascript">
        

    $(document).on("click", "#btnSave", function () {
        var STudentName = $("#STudentName").val();
        var StudentContactNo = $("#StudentContactNo").val();
        var id = $("#STudentName").attr("data-id");
        var stdDeptId = $("#stdDeptId").val();
        var stdSubInfoId = $("#stdSubInfoId").val();
          /*var ModuleNameForVoucherEntryId = $("#ddlModuleDropdown option:selected").val();*/
          /*console.log(ModuleNameForVoucherEntryId);*/
        if (STudentName == "") {
            $.alert.open("info", "Please select student Name.");
            return false;
        } else if (StudentContactNo == "") {
             $.alert.open("info", "Please select student Mobile Number.");
             return false;
         }

        $.ajax({
            type: "Post",
            url: '@Url.Action("SaveStudent", "StdInfo")',
            contentType: "application/json; charset=utf-8",

            data: JSON.stringify({ stdDeptId: stdDeptId, stdSubInfoId: stdSubInfoId, STudentName: STudentName, StudentContactNo: StudentContactNo, Id: id}),
            dataType: "json",
            success: function (dt) {
                if (dt.Status == true) {
                    $.alert.open("Messege!!", dt.Message, function () {
                        GetStudentDetailsList();
                        $("#stdDeptId").val(0);
                        $("#stdSubInfoId").val(0);
                        $("#STudentName").val('');
                        $("#StudentContactNo").val('');
                        $("#btnSave").prop("value", "Save");

                    });
                } else {
                    $.alert.open("Error!!", dt.Message);
                }
            }
        });
        return true;
    });

    function LoadEditData(Id, stdDeptId, stdSubInfoId, STudentName, StudentContactNo) {
      
        $("#stdDeptId").val(stdDeptId);
        $("#stdSubInfoId").val(stdSubInfoId);
        $("#STudentName").val(STudentName);
        $("#StudentContactNo").val(StudentContactNo);
        $("#STudentName").attr("data-id", Id);
        $("#btnSave").prop("value", "Update");
        ChangeSubjectDropdown(Id = stdSubInfoId);

    }
    //$(document).ready(function () {
    //    GetStudentList();
    //    console.log(GetStudentList);
    //});

     function GetStudentDetailsList() {
        var dataSource = new kendo.data.DataSource({
            transport: {
                read: {
                    url: '@Url.Action("GetStudentDetails", "StdInfo", "http")',
                    dataType: "json",
                    data: {}
                }
            },
            pageSize: 100,

        });
         $("#grid").kendoGrid({
            dataSource: dataSource,
            height: 300,
            groupable: true,
            reorderable: true,
            filterable: true,
            sortable: true,
            resizable: true,
            columnMenu: true,
            noRecords: {
                template: "Please Check again there is no data avaiable right now!"
            },
            pageable: {
                refresh: true,
                pageSizes: true,
                buttonCount: 5
            },
            columns: [
                {
                    title: "SL",
                    field: "RowSl",
                    width: "10%",
                },
                {
                    field: "STudentName",
                    title: "Student Name",
                },
                {
                    field: "StudentContactNo",
                    title: "Mobile Number",
                },
                {
                    field: "DeptName",
                    title: "Department Name",
                },
                {
                    field: "SubjectShortName",
                    title: "Subject",
                },
                {
                    title: "Commands",
                    width: "10%",
                    template: function (r) {
                        return '<a href="#" title="Change Status" onclick="LoadEditData(' + r.Id + ',' + r.stdDeptId + ',' + r.stdSubInfoId + ',' + "'" + r.STudentName + "'" + ', ' + "'" + r.StudentContactNo + "'" + ');"id="clickedit", class="btn-action btn-primary"><i class="fa fa-pencil-square-o"></i></a>'
                            + '<a href="#" title="Change Status" onclick="DeleteCategoryInfo(' + r.Id + ');" class="btn-action btn-danger"><i class="fa fa-trash-o"></i></a>';
                    }
                }

                ]
        });
    }

    function DeleteCategoryInfo(Id)
    {
        $.alert.open('confirm', 'Do you want to delete this record?', function (button) {
            if (button == 'yes') {
                $("#AjaxLoader").show();
                $.ajax({
                    type: 'POST',
                    url: '@Url.Action("DeleteStudent", "StdInfo", "http")',
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify({ Id: Id }),
                    dataType: 'json',
                    success: function (data) {
                        $("#AjaxLoader").hide();
                        if (data.Status == true) {
                            $.alert.open("Success!!", data.Message, function () {
                                window.location.reload();
                            });
                        }
                        else {
                            $.alert.open("Error!!", data.Message);
                        }

                    }
                });
            }
            else {
                return false;
            }
        });

    }
     function ChangeSubjectDropdown(Id = 0) {

            var stdSubInfoId = $("#stdSubInfoId");
            var ddlDepartment = $("#stdDeptId").val();
        $.ajax({
            type: 'GET',
            contentType: "application/json; charset=utf-8",
            url: '@Url.Action("GetChangeSubjectDropdown", "StdInfo", "http")',
            data: { Id: ddlDepartment },
            dataType: 'json',
            async: true,
            success: function (data) {
                stdSubInfoId.html('');
                stdSubInfoId.append($('<option></option>').val("0").html("Please Select"));
                $.each(data.data, function (id, option) {
                    stdSubInfoId.append($('<option></option>').val(option.Id).html(option.SubjectShortName));

                });
                if (Id != 0) {
                    $("#stdSubInfoId").val(Id);
                }
            },
            error: function (request, status, error) {
                alert(request.statusText + "/" + request.statusText + "/" + error);
            }
        });
    }


        $(document).on("change", "#stdDeptId", function () {
            ChangeSubjectDropdown(Id = 0);

        });
   
    $(document).ready(function () {
        GetStudentDetailsList();

    });
</script>